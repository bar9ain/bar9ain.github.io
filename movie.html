<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bargain</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
</head>

<body style="margin:0; font-family: Roboto;">
    <page-list-master class="ion-page show-page" style="z-index: 100;">
        <ion-header class="header header-ios">
            <ion-navbar class="toolbar toolbar-ios statusbar-padding">
                <div class="toolbar-background toolbar-background-ios"></div>
                <div class="toolbar-content toolbar-content-ios">
                    <ion-title class="title title-ios">
                        <div class="toolbar-title toolbar-title-ios" id="titleBar"></div>
                    </ion-title>
                </div>
            </ion-navbar>
        </ion-header>

        <ion-content class="content content-ios">
            <div class="scroll-content" style="margin-top: 48px;">
                <ion-list class="list list-ios">
                    <ion-loading>
                        <ion-icon class="icon-loading" style="display:none"></ion-icon>
                        <ion-item-sliding class="item-wrapper" style="display:none">
                            <a class="item item-block item-ios">
                                <ion-thumbnail item-start>
                                    <img src="">
                                </ion-thumbnail>
                                <ion-icon class="icon" item-start></ion-icon>
                                <div class="item-inner">
                                    <div class="input-wrapper">
                                        <ion-label class="label label-md">
                                            <h2>
                                                <i class="icon ion-loading-a"></i>
                                            </h2>
                                            <p class="english"></p>
                                            <p class="description"></p>
                                        </ion-label>
                                    </div>
                                </div>
                            </a>
                        </ion-item-sliding>
                    </ion-loading>
                </ion-list>
            </div>
        </ion-content>
    </page-list-master>
    
    <script src="assets/js/jquery-1.11.3.js"></script>
    <script src="assets/js/bargain-1.0.0.js"></script>
    <script src="assets/js/gibberish-aes-1.0.0.js"></script>
    <script src="assets/js/banhtv.js"></script>
    <script>
        window.onerror = function myErrorHandler(err, url, line) {
            $("ion-list").html("<h2 style='text-align:center'>" + err + line + "</h2>");
        };
        $(document).ready(function () {
            $("ion-list").append(loading);
            loading.show();
            var param = window.location.search;
            url = BanhTV.domain + param.split("=")[1];
            console.log(url);
            $.ajax({
                url: "http://cors-proxy.htmldriven.com/?url=" + url,
                type: "GET",
                success: function (result) {
                    var html = result.body;
                    var episodeList = $(html).find("#list_episodes li a");
                    movieId = url.substring(url.lastIndexOf("-") + 1).split(".")[0];
                    var lines = html.split("\n");
                    if (episodeList.length == 0) {
                        $.each(lines, function (index, element) {
                            getTitle(element);
                            if (contains(element, "var playerSetting")) {
                                var sourceLinks = JSON.parse(element.substring(0, element.length - 2).replace("var playerSetting = ", "")).sourceLinks;
                                BanhTV.getVideos(sourceLinks);
                                return;
                            }
                        });
                    }
                    else {
                        getEpisodes(episodeList);
                        $.each(lines, function (index, element) { getTitle(element); })
                    }
                    loading.hide();
                },
                error: function (data) {
                    loading.hide();
                    $("ion-list").html("<h2 style='text-align:center'>not found</h2>");
                }
            });
        });
    </script>
</body>

</html>