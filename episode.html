<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bargain</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
</head>

<body style="margin:0; font-family: Roboto;">
    <page-list-master class="ion-page show-page" style="z-index: 100;">
        <ion-header class="header header-ios">
            <ion-navbar class="toolbar toolbar-ios statusbar-padding">
                <div class="toolbar-background toolbar-background-ios"></div>
                <div class="toolbar-content toolbar-content-ios">
                    <ion-title class="title title-ios">
                        <div class="toolbar-title toolbar-title-ios" id="titleBar"></div>
                    </ion-title>
                </div>
            </ion-navbar>
        </ion-header>

        <ion-content class="content content-ios">
            <div class="scroll-content" style="margin-top: 48px;">
                <ion-list class="list list-ios"></ion-list>
            </div>
        </ion-content>
    </page-list-master>
    <script src="assets/js/jquery-1.11.3.js"></script>
    <script src="assets/js/bargain-1.0.0.js"></script>
    <script src="assets/js/gibberish-aes-1.0.0.js"></script>
    <script src="assets/js/banhtv.js"></script>
    <script>
        window.onerror = function myErrorHandler(err, url, line) {
            $("ion-list").html("<h2 style='text-align:center'>" + err + "</h2>");
        };
        $(document).ready(function () {
            $("ion-list").append(loading);
            loading.show();
            var param = window.location.search;
            url = param.split("=")[1];
            episodeId = url.substring(url.lastIndexOf("-") + 2);
            url = BanhTV.domain + url + ".html";
            $.ajax({
                url: "http://cors-proxy.htmldriven.com/?url=" + url,
                type: "GET",
                success: function (data) {
                    html = data.body;
                    document.title = $(html).find(".film-info h1").text();
                    $("#titleBar").text(document.title);
                    videoButtons = $(html).find("#list-server .btn");
                    movieId = $(html).find("#film_id").val();
                    for (i = 0; i < videoButtons.length; i++) {
                        videoId = videoButtons.eq(i).data("index");
                        videoURL = "http://" + BanhTV.page + ".com/ajax/getLinkPlayer/id/" + episodeId + "/index/" + videoId;
                        $.getJSON('http://cors-proxy.htmldriven.com/?url=' + videoURL,
                            function (result) {
                                var sourceLinks = $.parseJSON(result.body).sourceLinks;
                                BanhTV.getVideos(sourceLinks);
                            });
                    }
                    loading.hide();
                },
                error: function (data) {
                    loading.hide();
                    console.log(data.statusText);
                    $("ion-list").html("<h2 style='text-align:center'>not found</h2>");
                }
            });
        });
    </script>
</body>

</html>